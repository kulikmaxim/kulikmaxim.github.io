!function t(e,n,o){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n||t)},l,l.exports,t,e,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var i=o(t("./utils/router")),r=o(t("./routes/routes"));new i.default(r.default);document.getElementById("links").addEventListener("click",function(t){if(t.target.matches("a")){t.preventDefault();var e=t.target.getAttribute("href");window.location.hash=e}})},{"./routes/routes":6,"./utils/router":10}],2:[function(t,e,n){"use strict";function o(t,e){var n=this;this.options=t,this.requestService=e,this.container=document.getElementById(this.options.container),window.addEventListener("hashchange",function(){var t=(0,i.getMapStateFromHash)();t&&n.getForecastWeather(t.center[0],t.center[1])})}Object.defineProperty(n,"__esModule",{value:!0});var i=t("../utils/utils");o.prototype.render=function(t){var e="<ul><div>"+(this.options.label||"")+"</div>";e+="<li>Описание: "+t.summary+"</li><li>Температура: "+t.temperature+" C</li>",e+="<li>Скорость ветра: "+t.windSpeed+" м/с</li><li>Давление: "+t.pressure+" гПа</li>",e+="<li>Влажность: "+100*t.humidity+" %</li><li>Точка росы: "+t.dewPoint+" C</li>",e+="<li>Вероятность осадков: "+100*t.precipProbability+" %</li></ul>",this.container.innerHTML=e},o.prototype.getForecastWeather=function(t,e){var n=this;this.requestService.getForecastWeatherByLocation(t,e).then(function(t){return n.render(t)}).catch(function(){return n.container.innerHTML="Ошибка!"})},n.default=o},{"../utils/utils":11}],3:[function(t,e,n){"use strict";function o(t,e,n){this.options=t,this.eventBus=e,this.storage=n,this.container=document.getElementById(this.options.container),this.init()}Object.defineProperty(n,"__esModule",{value:!0});var i=Symbol("list");o.prototype.init=function(){var t=this;this.storage.getData(this.options.container).then(function(e){return t[i]=e||[]}).then(function(){return t.render()}).then(function(){return t.subscribeToClick()}),this.options.eventNameForAddElement&&this.addElementByEvent(this.options.eventNameForAddElement)},o.prototype.render=function(){var t="<ul><div>"+(this.options.label||"")+"</div>",e=this.options.allowDeleteElements?'<input type="button" value="x">':"";this[i].forEach(function(n,o){return t+="<li data-index="+o+"><span>"+n.address+"</span>"+e+"</li>"}),t+="</ul>",this.container.innerHTML=t},o.prototype.addElement=function(t){this[i].unshift(t),this.options.capacity&&this.options.capacity<this[i].length&&this[i].pop(),this.storage.setData(this.options.container,this[i]),this.render()},o.prototype.deleteElement=function(t){var e=+t.getAttribute("data-index");this[i].splice(e,1),this.storage.setData(this.options.container,this[i]),this.render()},o.prototype.addElementByEvent=function(t){var e=this;this.eventBus.on(t,function(t){return e.addElement(t)})},o.prototype.subscribeToClick=function(){var t=this;this.container.addEventListener("click",function(e){if(t.options.allowDeleteElements&&e.target.matches("input[type=button]")&&t.deleteElement(e.target.parentNode),event.target.matches("span")){var n=+e.target.parentNode.getAttribute("data-index");t.eventBus.trigger("list:elementClick",t[i][n])}})},n.default=o},{}],4:[function(t,e,n){"use strict";function o(t,e,n){this.options=t,this.container=document.getElementById(t.container),this.eventBus=e,this.requestService=n,this.render(),this.init()}Object.defineProperty(n,"__esModule",{value:!0});t("../utils/utils");o.prototype.render=function(){var t='<form><input type="text" name="address"><input type="submit" value="Найти">';t+='<input type="radio" name="requestType" value="xhr" checked> xhr',t+='<input type="radio" name="requestType" value="fetch"> fetch</form>',this.container.innerHTML=t},o.prototype.init=function(){var t=this,e=this.container.getElementsByTagName("form")[0];e.addEventListener("change",function(n){n.target.matches("input[type=radio]")&&(t.requestService.options.requestType=e.requestType.value)}),e.addEventListener("submit",function(n){return n.preventDefault(),t.requestService.getObjectLocationByAddress(e.address.value).then(function(e){return t.eventBus.trigger("search:objectLocationLoaded",e)})})},n.default=o},{"../utils/utils":11}],5:[function(t,e,n){"use strict";function o(t,e,n,o){var i=this;this.options=t,this.ymaps=e,this.eventBus=n,this.requestService=o,this.ymaps.ready(function(){return i.init()})}Object.defineProperty(n,"__esModule",{value:!0});var i=t("../utils/utils"),r=Symbol("map");o.prototype.init=function(){var t=this;this[r]=new this.ymaps.Map(this.options.container,{center:this.options.center,zoom:this.options.zoom,mapType:this.options.mapType,controls:this.options.controls}),this.subscribeToChangeMapCenter(),this.subscribeToMapClick(),this.eventBus.on("search:objectLocationLoaded",function(e){var n=e.lat,o=e.lng;return t.changeMapCenter(n,o)}),this.eventBus.on("list:elementClick",function(e){var n=e.lat,o=e.lng;return t.changeMapCenter(n,o)})},o.prototype.changeMapCenter=function(t,e){this[r].panTo([t,e],{flying:!0,duration:300})},o.prototype.subscribeToMapClick=function(){var t=this;this[r].events.add("click",function(e){var n=e.get("coords");t[r].balloon.open(n,"Added to Favorites"),t.requestService.getObjectNameByLocation(n[0],n[1]).then(function(e){return t.eventBus.trigger("yandexMap:click",e)}).catch()})},o.prototype.subscribeToChangeMapCenter=function(){var t=this,e=(0,i.debounce)(function(){(0,i.setHashByMapState)({mapType:t[r].getType().split("#")[1],center:t[r].getCenter(),zoom:t[r].getZoom()})},200);this[r].events.add(["boundschange","typechange"],function(){return e()})},n.default=o},{"../utils/utils":11}],6:[function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t){E.innerHTML='<div id="search"></div><hr><div id="map" class="mapContainer"></div><hr><div id="history" class="history"></div><div id="forecast" class="forecast"></div><div id="favorites" class="favorites"></div>',r=new p.default,s=new m.default({container:"search"},r,b),(a=new y.default({container:"forecast",label:"Погода"},b)).getForecastWeather(t.center[0],t.center[1]),u=new f.default({container:"history",label:"История",capacity:5,eventNameForAddElement:"search:objectLocationLoaded"},r,g.default),c=new f.default({container:"favorites",label:"Закладки",allowDeleteElements:!0,eventNameForAddElement:"yandexMap:click"},r,g.default),l=new d.default({container:"map",mapType:t.mapType,center:t.center,zoom:t.zoom,controls:["zoomControl","rulerControl","typeSelector"]},ymaps,r,b)}Object.defineProperty(n,"__esModule",{value:!0});var r,s,a,u,c,l,p=o(t("../utils/eventBus")),h=o(t("../utils/requestService")),d=o(t("../components/yandexMap")),f=o(t("../components/list")),m=o(t("../components/search")),y=o(t("../components/forecastWeather")),v=t("../utils/utils"),g=o(t("../utils/localStorage")),b=new h.default({requestType:"xhr"}),E=document.getElementById("content"),w=[{name:"index",match:"",onEnter:function(){b.getUserLocation().then(function(t){var e=t.lat,n=t.lng;return(0,v.setHashByMapState)({mapType:"map",center:[e,n],zoom:7})})}},{name:"about",match:"#about",onBeforeEnter:function(){return r=null,s=null,a=null,u=null,c=null,void(l=null)},onEnter:function(){return E.innerHTML='<div>О сайте: прогноз погоды</div><img src="img/photo.jpg" class="photo">'}},{name:"city",match:/city=(.+)/,onEnter:function(t){b.getObjectLocationByAddress(t).then(function(t){var e={mapType:"map",center:[t.lat,t.lng],zoom:7};l||r||u||c||s||a?l.changeMapCenter(e.center[0],e.center[1]):i(e)})}},{name:"map",match:v.getMapStateFromHash,onEnter:function(t){l||r||u||c||s||a||i(t)}}];n.default=w},{"../components/forecastWeather":2,"../components/list":3,"../components/search":4,"../components/yandexMap":5,"../utils/eventBus":7,"../utils/localStorage":8,"../utils/requestService":9,"../utils/utils":11}],7:[function(t,e,n){"use strict";function o(){this[i]={}}Object.defineProperty(n,"__esModule",{value:!0});var i=Symbol("listeners");o.prototype.on=function(t,e){this[i][t]=this[i][t]||[],this[i][t].push(e)},o.prototype.off=function(t,e){e?this[i][t]=(this[i][t]||[]).filter(function(t){return t!==e}):this[i][t].splice(0,this[i][t].length)},o.prototype.trigger=function(t){if(this[i][t]){var e=Array.prototype.slice.call(arguments,1);this[i][t].forEach(function(t){return t.apply(null,e)})}},o.prototype.once=function(t,e){var n=this;this.on(t,function o(){n.off(t,o),e.apply(null,arguments)})},n.default=o},{}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o={getData:function(t){return Promise.resolve(JSON.parse(window.localStorage.getItem(t)))},setData:function(t,e){return new Promise(function(n,o){return t&&e?window.localStorage.setItem(t,JSON.stringify(e)):o()})}};n.default=o},{}],9:[function(t,e,n){"use strict";function o(t){this.options=t}function i(t){return t.results.length?t.results[0].formatted_address:"unknown"}function r(t,e){return"fetch"===e?fetch(t).then(function(t){return t.json()}):new Promise(function(e,n){var o=new XMLHttpRequest;o.onload=function(){return 200===o.status?e(JSON.parse(o.response)):n()},o.onerror=function(){return n()},o.open("GET",t,!0),o.send()})}Object.defineProperty(n,"__esModule",{value:!0}),o.prototype.getUserLocation=function(){return r("https://api.userinfo.io/userinfos",this.options.requestType).then(function(t){return{lat:t.position.latitude,lng:t.position.longitude}})},o.prototype.getObjectLocationByAddress=function(t){return r("https://maps.googleapis.com/maps/api/geocode/json?address="+t+"&key=AIzaSyDa7DCL2NO9KMPd9DYVk_u3u0wCbm0XXFY",this.options.requestType).then(function(t){return{lat:t.results[0].geometry.location.lat,lng:t.results[0].geometry.location.lng,address:i(t)}})},o.prototype.getObjectNameByLocation=function(t,e){return r("https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+e+"&key=AIzaSyDa7DCL2NO9KMPd9DYVk_u3u0wCbm0XXFY",this.options.requestType).then(function(n){return{lat:t,lng:e,address:i(n)}})},o.prototype.getForecastWeatherByLocation=function(t,e){return r("https://cors-anywhere.herokuapp.com/"+("https://api.darksky.net/forecast/d113af5f82393ef553f48314ae9f42e8/"+t+","+e+"?exclude=daily,minutely,hourly,flags&lang=ru&units=si"),this.options.requestType).then(function(t){return t.currently})},n.default=o},{}],10:[function(t,e,n){"use strict";function o(t){this.routes=t||[],this.init()}Object.defineProperty(n,"__esModule",{value:!0}),o.prototype.init=function(){var t=this;window.addEventListener("hashchange",function(){return t.handleUrl(window.location.hash)}),this.handleUrl(window.location.hash)},o.prototype.handleUrl=function(t){var e=this,n=this.findRoute(t),o=this.getUrlParams(n,t);return Promise.resolve().then(function(){return e.currentRoute&&e.currentRoute.onLeave&&e.currentRoute.onLeave(e.currentRouteParams)}).then(function(){return n&&n.onBeforeEnter&&n.onBeforeEnter(o)}).then(function(){return n&&n.onEnter&&n.onEnter(o)}).then(function(){e.currentRoute=n,e.currentRouteParams=o})},o.prototype.findRoute=function(t){return this.routes.find(function(e){return"string"==typeof e.match?e.match===t:e.match instanceof RegExp?e.match.test(t):"function"==typeof e.match?e.match(t):void 0})},o.prototype.getUrlParams=function(t,e){if(t)return t.match instanceof RegExp?e.match(t.match):"function"==typeof t.match?t.match(e):void 0},n.default=o},{}],11:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=/#type=(\w+?)&center=(-?\d*[.]?\d+),(-?\d*[.]?\d+)&zoom=(\d{1,2})/;n.getMapStateFromHash=function(){var t=window.location.hash.match(o);return t&&{mapType:t[1],center:[t[2],t[3]],zoom:t[4]}},n.setHashByMapState=function(t){window.location.hash="type="+t.mapType+"&center="+t.center+"&zoom="+t.zoom},n.debounce=function(t,e){var n;return function(){var o=Array.prototype.slice.call(arguments,0);clearTimeout(n),n=setTimeout(function(){n=null,t.apply(null,o)},e)}}},{}]},{},[1]);